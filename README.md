# Монитор слотов Лужники (Playwright + Telegram)

Этот репозиторий отслеживает **появление новых дней и слотов** на странице: https://tennis.luzhniki.ru/#courts  
При появлении новинок присылает сообщение в Telegram-чат.

## Быстрый старт (локально)
1. Установите Node 20+.
2. Склонируйте папку и установите зависимости:
   ```bash
   npm i
   npx playwright install --with-deps chromium
   ```
3. Создайте Telegram-бота через @BotFather, получите **BOT_TOKEN**. Узнайте **CHAT_ID** (можно написать боту и посмотреть `chat.id` через @userinfobot либо добавить бота в группу и получить group id).
4. Запустите монитор:
   ```bash
   TG_BOT_TOKEN=XXX TG_CHAT_ID=123456 node monitor-luzhniki.js
   ```
   При первом запуске создастся `known-slots.json`. Сообщения придут **только** при появлении новых комбинаций "день | корт | время".

## Деплой без сервера (GitHub Actions)
1. Создайте репозиторий и загрузите файлы.
2. В репозитории откройте **Settings → Secrets and variables → Actions → New repository secret**:
   - `TG_BOT_TOKEN` — токен бота
   - `TG_CHAT_ID` — id чата/группы
3. Вкладка **Actions** → разрешите воркфлоу. Он будет запускаться каждые 10 минут.
4. Чтобы запустить вручную: Actions → workflow → **Run workflow**.

## Настройки и советы
- Частоту можно изменить в `.github/workflows/luzhniki.yml` (`cron`).
- Для отбора конкретных кортов/часов добавьте фильтры в `monitor-luzhniki.js` перед формированием списка `fresh`.
- Если виджет находится внутри `iframe`, скрипт попытается автоматически найти нужный фрейм. При желании можно жёстко выбрать фрейм по URL/имени.
- История известных слотов хранится в `known-slots.json`. Если нужно «забыть» состояние, удалите файл.

## Трейблшутинг
- **Нет сообщений в Telegram**: проверьте переменные окружения `TG_BOT_TOKEN` и `TG_CHAT_ID`, и что бот добавлен в чат (для групп — бот должен быть участником).
- **Слишком много «ложных» новинок**: иногда сайт меняет текст вокруг; можно нормализовать строки (replace/trim) или отсекать «День?»/«Корт?».
- **Парсинг API вместо DOM**: в DevTools → Network найдите XHR к бэкенду расписания. Если он есть и отдаёт JSON, проще опрашивать JSON и сравнивать массив слотов.
