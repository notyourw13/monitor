name: Luzhniki Monitor

on:
  schedule:
    - cron: "*/10 * * * *"  # каждые 10 минут
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install deps
        run: |
          npm install playwright node-fetch@2 proxy-chain socks-proxy-agent@6.2.1 https-proxy-agent@5 http-proxy-agent@5

      - name: Install Playwright browsers (Chromium)
        run: npx playwright install --with-deps chromium

      - name: Run monitor
        run: node monitor-luzhniki.js
        env:
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
          # Список прокси в виде строк, разделённых переводом строки.
          # Поддерживаются: http(s)://host:port, socks5://user:pass@host:port, http://user:pass@host:port
          PROXY_LIST: ${{ secrets.PROXY_LIST }}
          # Включаем режим "присылай всё":
          SEND_ALL: '1'
          # Подробные логи:
          DEBUG: '1'
